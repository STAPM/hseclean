<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Survey Data Wrangling • hseclean</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Health Survey Data Wrangling">
<meta property="og:description" content="Functions to read the data, rename, organise and process the variables required, impute missing data, and summarise data.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">hseclean</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/alcohol_data.html">Process data on alcohol consumption</a>
    </li>
    <li>
      <a href="articles/covariate_data.html">Process data on individual socioeconomic, demographic and health characteristics</a>
    </li>
    <li>
      <a href="articles/missing_data.html">Imputation of missing data</a>
    </li>
    <li>
      <a href="articles/scottish_data.html">Addition of Scottish data</a>
    </li>
    <li>
      <a href="articles/smoking_data.html">Process data on tobacco smoking</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="hseclean" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#hseclean" class="anchor"></a>hseclean <img src="tools/hseclean_hex.png" align="right" style="padding-left:10px;background-color:white;" width="100" height="100">
</h1></div>

<p>The package is usable but there are still bugs and further developments that are being worked through i.e. some code and documentation is still incomplete or in need of being refined. The code and documentation are still undergoing internal review by the analyst team.</p>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p><code>hseclean</code> was created as part of a programme of work on the health economics of tobacco and alcohol at the School of Health and Related Research (ScHARR), The University of Sheffield. This programme is based around the construction of the Sheffield Tobacco and Alcohol Policy Model (STAPM), which aims to use comparable methodologies to evaluate the impacts of tobacco and alcohol policies, and investigate the consequences of clustering and interactions between tobacco and alcohol consumption behaviours.</p>
<p>The original motivation for <code>hseclean</code> was to standardised the way that the Health Survey for England (HSE) data were cleaned and prepared for our analyses and inputs to our decision-analytic models. The suite of functions within <code>hseclean</code> reads the data for each year since 2001, renames, organises and processes the variables that we use for our analyses. The package also includes functions to multiply impute missing data, and to summarise data considering survey design.</p>
<p>We have subsequently added functions to process the Scottish Health Survey (SHeS) into a form that matches our processing of the Health Survey for England.</p>
<blockquote>
<p>Health Survey for England and Scottish Health Survey data are accessed via the UK Data Service. <code>hseclean</code> is designed to read the tab delimited files.</p>
</blockquote>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p><code>hseclean</code> is a package for reading and cleaning the Health Survey for England and Scottish Health Survey data.</p>
<p>The <strong>inputs</strong> are the raw survey data files for each year.</p>
<p>The <strong>processes</strong> applied by the functions in <code>hseclean</code> give options to:</p>
<ol>
<li>Read tobacco and alcohol related variables and the information on individual characteristics that we use in our analyses.<br>
</li>
<li>Clean alcohol consumption data, applying assumptions about beverage size and alcohol content.<br>
</li>
<li>Clean data on current smoking and smoking history.<br>
</li>
<li>Clean data on individual characteristics including age, sex, ethnicity, economic status, family, health and income.<br>
</li>
<li>Multiply impute missing data.<br>
</li>
<li>Summarise categorical variables using proportions, considering survey design.</li>
</ol>
<p>The <strong>output</strong> of these processes is a cleaned dataset that is ready for further analysis. This dataset can be saved so that you don’t need to run the cleaning processes in <code>hseclean</code> each time you want to use the cleaned data.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Please see file LICENCE.</p>
<p>You can install the development version of <code>hseclean</code> from github with:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co">#install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"dosgillespie/hseclean"</span>)</pre></div>
<hr>
<p>On Windows, there might be an error with <code>install_github()</code> due to long file paths (Windows has a limit on file path length). One possible work-around is</p>
<ol>
<li><p>Download the package “tarball” by copying this into your internet browser (making sure the numbers at the end indicate the latest version) <code>https://github.com/dosgillespie/hseclean/tarball/0.3.3</code>. When the window pops up, choose where to save the file. The file I downloaded was dosgillespie-hseclean-0.3.3-0-ga16f575.tar.gz and I saved it to Downloads.</p></li>
<li><p>Go to the Terminal window in R Studio (or a console window in Windows by searching for “cmd”) and install the package from the downloaded file by typing <code>R CMD INSTALL Downloads/dosgillespie-hseclean-0.3.3-0-ga16f575.tar.gz</code>.</p></li>
</ol>
<hr>
<p>Then load the package, and some other packages that are useful. Note that the code within <code>hseclean</code> uses the <code><a href="https://rdrr.io/pkg/data.table/man/data.table.html">data.table::data.table()</a></code> syntax.</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co"># Load the package</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">hseclean</span>)

<span class="co"># Other useful packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>) <span class="co"># for data manipulation and summary</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>) <span class="co"># for pipes</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>) <span class="co"># for plotting</span></pre></div>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h2>
<p>To be able to <strong>download data from the UK Data Service</strong>, you will need to <strong>register with the UK Data Service website</strong>, which will enable you to request access to the datasets. Instructions on how to do this can be found <a href="https://www.ukdataservice.ac.uk/get-data/how-to-access.aspx">here</a>.</p>
<p>In ScHARR, all data is stored and processed according to the <a href="https://www.sheffield.ac.uk/scharr/research/igov/policy00">ScHARR Information Governance Policy</a>. The HSE and SHeS data is stored in the university networked X-drive folder <code>PR_Consumption_TA</code>, which is accessible only to team members who are using data according to the purposes stated to the UK Data Service. No individual-level data is included within this package on Github.</p>
</div>
<div id="basic-functionality" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-functionality" class="anchor"></a>Basic functionality</h2>
<div id="reading-the-hse-data-files" class="section level3">
<h3 class="hasAnchor">
<a href="#reading-the-hse-data-files" class="anchor"></a>Reading the HSE data files</h3>
<p>There are separate functions in <code>hseclean</code> to read each year of HSE data. You must specify the link to where the data is stored. The functions read in all variables related to tobacco and alcohol and selected socioeconomic and other descriptor variables.</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="no">test_2001</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/read_2001.html">read_2001</a></span>(
  <span class="kw">root</span> <span class="kw">=</span> <span class="st">"X:/"</span>,
  <span class="kw">file</span> <span class="kw">=</span> <span class="st">"ScHARR/PR_Consumption_TA/HSE/HSE 2001/UKDA-4628-tab/tab/hse01ai.tab"</span>
)</pre></div>
<hr>
<p><code>hseclean</code> contains separate functions for reading the survey data for each year, e.g. <code><a href="reference/read_SHeS_2008.html">read_SHeS_2008()</a></code>.</p>
</div>
<div id="processing-socioeconomic-demographic-and-health-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#processing-socioeconomic-demographic-and-health-variables" class="anchor"></a>Processing socioeconomic, demographic and health variables</h3>
<p>There are separate functions that focus on processing a different theme of socioeconomic, demographic and health variables. See <code><a href="articles/covariate_data.html">vignette("covariate_data")</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)

<span class="no">temp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/read_2017.html">read_2017</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>) <span class="kw">%&gt;%</span>
  <span class="no">clean_age</span> <span class="kw">%&gt;%</span>
  <span class="no">clean_family</span> <span class="kw">%&gt;%</span>
  <span class="no">clean_demographic</span> <span class="kw">%&gt;%</span>
  <span class="no">clean_education</span> <span class="kw">%&gt;%</span>
  <span class="no">clean_economic_status</span> <span class="kw">%&gt;%</span>
  <span class="no">clean_income</span> <span class="kw">%&gt;%</span>
  <span class="no">clean_health_and_bio</span></pre></div>
</div>
<div id="alcohol-data" class="section level3">
<h3 class="hasAnchor">
<a href="#alcohol-data" class="anchor"></a>Alcohol data</h3>
<p>Detailed description of how to clean the alcohol data are given in <code><a href="articles/alcohol_data.html">vignette("alcohol_data")</a></code>. As an example, here is the workflow to plot the frquency of drinking among people who drank in 2017.</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="co"># Frequency of drinking in 2017 among drinkers</span>
<span class="no">root_dir</span> <span class="kw">&lt;-</span> <span class="st">"/Volumes/Shared/"</span>
<span class="co">#root_dir &lt;- "X:/"</span>

<span class="fu"><a href="reference/read_2017.html">read_2017</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>) <span class="kw">%&gt;%</span>
  <span class="no">clean_age</span> <span class="kw">%&gt;%</span>
  <span class="no">clean_demographic</span> <span class="kw">%&gt;%</span>
  <span class="no">alc_drink_now_allages</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">age</span> <span class="kw">&lt;</span> <span class="fl">90</span>, <span class="no">age</span> <span class="kw">&gt;=</span> <span class="fl">8</span>, <span class="no">drinks_now</span> <span class="kw">==</span> <span class="st">"drinker"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">imd_quintile</span>, <span class="no">age_cat</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="kw">av_freq</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">drink_freq_7d</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="no">T</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">imd_quintile</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">av_freq</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">age_cat</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span> <span class="kw">=</span> <span class="st">"identity"</span>, <span class="kw">position</span> <span class="kw">=</span> <span class="st">"dodge"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"average number of days drink in a week"</span>)</pre></div>
</div>
<div id="clean-all-years-of-smoking-and-alcohol-data" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-all-years-of-smoking-and-alcohol-data" class="anchor"></a>Clean all years of smoking and alcohol data</h3>
<p>See <code><a href="articles/smoking_data.html">vignette("smoking_data")</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)

<span class="co"># Wrap the individual cleaning functions in another function for applying to each year</span>

<span class="no">cleandata</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">data</span>) {

  <span class="no">data</span> <span class="kw">%&lt;&gt;%</span>
    <span class="no">clean_age</span> <span class="kw">%&gt;%</span>
    <span class="no">clean_family</span> <span class="kw">%&gt;%</span>
    <span class="no">clean_demographic</span> <span class="kw">%&gt;%</span>
    <span class="no">clean_education</span> <span class="kw">%&gt;%</span>
    <span class="no">clean_economic_status</span> <span class="kw">%&gt;%</span>
    <span class="no">clean_income</span> <span class="kw">%&gt;%</span>
    <span class="no">clean_health_and_bio</span> <span class="kw">%&gt;%</span>
    <span class="no">smk_status</span> <span class="kw">%&gt;%</span>
    <span class="no">smk_former</span> <span class="kw">%&gt;%</span>
    <span class="no">smk_life_history</span> <span class="kw">%&gt;%</span>
    <span class="no">smk_amount</span> <span class="kw">%&gt;%</span>
    <span class="no">alc_drink_now_allages</span> <span class="kw">%&gt;%</span>
    <span class="no">alc_weekmean_adult</span> <span class="kw">%&gt;%</span>
    <span class="no">alc_sevenday_adult</span> <span class="kw">%&gt;%</span>
    <span class="no">alc_sevenday_child</span> <span class="kw">%&gt;%</span>

    <span class="fu"><a href="reference/select_data.html">select_data</a></span>(
      <span class="kw">ages</span> <span class="kw">=</span> <span class="fl">12</span>:<span class="fl">89</span>,
      <span class="kw">years</span> <span class="kw">=</span> <span class="fl">2001</span>:<span class="fl">2017</span>,

      <span class="co"># variables to retain</span>
      <span class="kw">keep_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"wt_int"</span>, <span class="st">"psu"</span>, <span class="st">"cluster"</span>, <span class="st">"year"</span>, <span class="st">"quarter"</span>,
                    <span class="st">"age"</span>, <span class="st">"age_cat"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>,
                    <span class="st">"ethnicity_4cat"</span>, <span class="st">"ethnicity_2cat"</span>,
                    <span class="st">"degree"</span>, <span class="st">"relationship_status"</span>, <span class="st">"employ2cat"</span>, <span class="st">"social_grade"</span>, <span class="st">"kids"</span>, <span class="st">"income5cat"</span>,
                    <span class="st">"nssec3_lab"</span>, <span class="st">"man_nonman"</span>, <span class="st">"activity_lstweek"</span>, <span class="st">"eduend4cat"</span>,

                    <span class="st">"hse_cancer"</span>, <span class="st">"hse_endocrine"</span>, <span class="st">"hse_heart"</span>, <span class="st">"hse_mental"</span>, <span class="st">"hse_nervous"</span>, <span class="st">"hse_eye"</span>, <span class="st">"hse_ear"</span>, <span class="st">"hse_respir"</span>,
                    <span class="st">"hse_disgest"</span>, <span class="st">"hse_urinary"</span>, <span class="st">"hse_skin"</span>, <span class="st">"hse_muscskel"</span>, <span class="st">"hse_infect"</span>, <span class="st">"hse_blood"</span>,

                    <span class="st">"weight"</span>, <span class="st">"height"</span>,

                    <span class="st">"cig_smoker_status"</span>, <span class="st">"years_since_quit"</span>, <span class="st">"years_reg_smoker"</span>, <span class="st">"cig_ever"</span>,
                    <span class="st">"cigs_per_day"</span>, <span class="st">"smoker_cat"</span>, <span class="st">"banded_consumption"</span>, <span class="st">"cig_type"</span>, <span class="st">"time_to_first_cig"</span>,
                    <span class="st">"smk_start_age"</span>, <span class="st">"smk_stop_age"</span>, <span class="st">"censor_age"</span>,

                    <span class="st">"drinks_now"</span>,
                    <span class="st">"drink_freq_7d"</span>, <span class="st">"n_days_drink"</span>, <span class="st">"peakday"</span>, <span class="st">"binge_cat"</span>,
                    <span class="st">"beer_units"</span>, <span class="st">"wine_units"</span>, <span class="st">"spirit_units"</span>, <span class="st">"rtd_units"</span>,
                    <span class="st">"weekmean"</span>,
                    <span class="st">"perc_spirit_units"</span>, <span class="st">"perc_wine_units"</span>, <span class="st">"perc_rtd_units"</span>, <span class="st">"perc_beer_units"</span>,
                    <span class="st">"drinker_cat"</span>,
                    <span class="st">"spirits_pref_cat"</span>, <span class="st">"wine_pref_cat"</span>, <span class="st">"rtd_pref_cat"</span>, <span class="st">"beer_pref_cat"</span>,
                    <span class="st">"total_units7_ch"</span>
      ),

      <span class="co"># The variables that must have complete cases</span>
      <span class="kw">complete_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"year"</span>, <span class="st">"quarter"</span>, <span class="st">"psu"</span>, <span class="st">"cluster"</span>)
    )

  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">data</span>)
}

<span class="co"># Read and clean each year of data and bind them together in one big dataset</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/combine_years.html">combine_years</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2001.html">read_2001</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2002.html">read_2002</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2003.html">read_2003</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2004.html">read_2004</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2005.html">read_2005</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2006.html">read_2006</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2007.html">read_2007</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2008.html">read_2008</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2009.html">read_2009</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2010.html">read_2010</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2011.html">read_2011</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2012.html">read_2012</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2013.html">read_2013</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2014.html">read_2014</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2015.html">read_2015</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2016.html">read_2016</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>)),
  <span class="fu">cleandata</span>(<span class="fu"><a href="reference/read_2017.html">read_2017</a></span>(<span class="kw">root</span> <span class="kw">=</span> <span class="no">root_dir</span>))
))

<span class="co"># clean the survey weights</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/clean_surveyweights.html">clean_surveyweights</a></span>(<span class="no">data</span>)</pre></div>
</div>
<div id="summarise-data" class="section level3">
<h3 class="hasAnchor">
<a href="#summarise-data" class="anchor"></a>Summarise data</h3>
<p>The function <code><a href="https://rdrr.io/pkg/survey/man/svyby.html">survey::svyby()</a></code> in the <code>survey</code> R package is used by the function <code><a href="reference/prop_summary.html">prop_summary()</a></code> in <code>hseclean</code> to estimate the uncertainty around proportions calculated from a binary variable - <code><a href="reference/prop_summary.html">prop_summary()</a></code> was designed to simplify the process of estimating smoking prevalence from the HSE data, stratified by a specified set of variables.</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="no">prop_smokers</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/prop_summary.html">prop_summary</a></span>(
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">hse_data</span>,
  <span class="kw">var_name</span> <span class="kw">=</span> <span class="st">"smk.state"</span>,
  <span class="kw">levels_1</span> <span class="kw">=</span> <span class="st">"current"</span>,
  <span class="kw">levels_0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"former"</span>, <span class="st">"never"</span>),
  <span class="kw">strat_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>)
)</pre></div>
</div>
<div id="missing-data-imputation" class="section level3">
<h3 class="hasAnchor">
<a href="#missing-data-imputation" class="anchor"></a>Missing data imputation</h3>
<p><code>hseclean</code> uses the function <code><a href="http://stefvanbuuren.github.io/mice/reference/mice.html">mice::mice()</a></code> in the <code>mice</code> R package, implemented in a basic way by the <code><a href="reference/impute_data_mice.html">impute_data_mice()</a></code> function. See <code><a href="articles/missing_data.html">vignette("missing_data")</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="co"># Run the imputation (takes a long time)</span>
<span class="no">imp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/impute_data_mice.html">impute_data_mice</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">hse_data</span>,
                        <span class="kw">var_names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"smk.state"</span>, <span class="st">"agegroup"</span>, <span class="st">"sex"</span>,
                                      <span class="st">"imd_quintile"</span>, <span class="st">"degree"</span>, <span class="st">"kids"</span>, <span class="st">"income5cat"</span>,
                                      <span class="st">"relationship_status"</span>, <span class="st">"employ2cat"</span>, <span class="st">"social_grade"</span>),
                        <span class="kw">var_methods</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>,
                                        <span class="st">"polr"</span>, <span class="st">"logreg"</span>, <span class="st">"polr"</span>, <span class="st">"polr"</span>,
                                        <span class="st">"polyreg"</span>, <span class="st">"logreg"</span>, <span class="st">"logreg"</span>),
                        <span class="kw">n_imputations</span> <span class="kw">=</span> <span class="fl">5</span>)

<span class="co"># imp$data is a single data.table containing all 5 imputed versions of the data</span>
<span class="no">hse_data_imputed</span> <span class="kw">&lt;-</span> <span class="fu">copy</span>(<span class="no">imp</span>$<span class="no">data</span>)</pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/dosgillespie/hseclean">https://​github.com/​dosgillespie/​hseclean</a>
</li>
<li>Access data at <br><a href="https://www.ukdataservice.ac.uk/get-data/how-to-access.aspx">https://​www.ukdataservice.ac.uk/​get-data/​how-to-access.aspx</a>
</li>
<li>Read the ScHARR Information Governance Policy at <br><a href="https://www.sheffield.ac.uk/scharr/research/igov/policy00">https://​www.sheffield.ac.uk/​scharr/​research/​igov/​policy00</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>see file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d">Duncan Gillespie</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-3450-5747" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Laura Webster <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/angus_c">Colin Angus</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a">Alan Brennan</a> <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#active"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></li>
<li><a href="https://doi.org/10.5281/zenodo.3748784"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.3748784.svg" alt="DOI"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d">Duncan Gillespie</a>, Laura Webster, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/angus_c">Colin Angus</a>, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a">Alan Brennan</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
