<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Process data on tobacco smoking • hseclean</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Process data on tobacco smoking">
<meta property="og:description" content="hseclean">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hseclean</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/alcohol_data.html">Process data on alcohol consumption</a>
    </li>
    <li>
      <a href="../articles/covariate_data.html">Process data on individual socioeconomic, demographic and health characteristics</a>
    </li>
    <li>
      <a href="../articles/missing_data.html">Imputation of missing data</a>
    </li>
    <li>
      <a href="../articles/scottish_data.html">Addition of Scottish data</a>
    </li>
    <li>
      <a href="../articles/smoking_data.html">Process data on tobacco smoking</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Process data on tobacco smoking</h1>
            
      
      
      <div class="hidden name"><code>smoking_data.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>For the Sheffield Tobacco Policy Model (STPM) we use HSE data from years 2001 to the latest available. We use these data to inform the trends in smoking prevalence, the socio-demographic variation in smoking prevalence, and as inputs to a procedure that we use to infer the age-specific probabilities of smoking initiation and quitting (see our <code>smoke.trans</code> R package). Our upper age limit is 89 years, but otherwise we make use of all ages.</p>
<p>The purpose of this vignette is to explain how we use the HSE data to inform the patterns of tobacco smoking, and to explain how <code>hseclean</code> supports this.</p>
</div>
<div id="demographic-and-socio-economic-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#demographic-and-socio-economic-variables" class="anchor"></a>Demographic and socio-economic variables</h1>
<p><code>hseclean</code> contains functions to clean covariates in the data, which are explained in <code><a href="../articles/covariate_data.html">vignette("covariate_data")</a></code>. Here we mention only the important things to consider for the processing of smoking data.</p>
</div>
<div id="cigarette-smoking-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#cigarette-smoking-variables" class="anchor"></a>Cigarette smoking variables</h1>
<p>Questions about cigarette smoking have been asked of adults aged 16 and over as part of the HSE series since 1991 - we use data from 2001 to the latest year available. We use data on children (12-15 years) and adults (16+ years). There is often a special section in the annual HSE report devoted to describing trends in cigarette smoking e.g.<a href="https://files.digital.nhs.uk/publicationimport/pub22xxx/pub22610/hse2015-adult-smo.pdf">HSE 2015</a>.</p>
<div id="cigarette-smoking-status" class="section level2">
<h2 class="hasAnchor">
<a href="#cigarette-smoking-status" class="anchor"></a>Cigarette smoking status</h2>
<p>The function <code><a href="../reference/smk_status.html">smk_status()</a></code> categorises cigarette smoking into current, former and never regular cigarette smokers. If some smokes either regularly or ocassionally, then they are classified as a current regular cigarette smoker. People who used to smoke regularly or ocassionally are classified as former smokers; people who have only tried a cigarette once or twice are classified as never smokers. We create a smoking status variable for children aged 8-15 years and adults aged &gt;= 16 years. Ever-smokers are people who are either current or former smokers.</p>
</div>
<div id="quitting" class="section level2">
<h2 class="hasAnchor">
<a href="#quitting" class="anchor"></a>Quitting</h2>
<p>The function <code><a href="../reference/smk_quit.html">smk_quit()</a></code> is in development, and will process the data on the motivation to quit smoking, the reasons for quitting smoking, and the support used to stop smoking. It currently produces only one variable - whether someone wants to quit smoking (y/n).</p>
</div>
<div id="former-smoking" class="section level2">
<h2 class="hasAnchor">
<a href="#former-smoking" class="anchor"></a>Former smoking</h2>
<p>The function <code><a href="../reference/smk_former.html">smk_former()</a></code> cleans the data for former smokers on the time since quitting and time spent as a regular smoker. The main issue to overcome is that in the HSE 2015+, time since quit and time spent as a smoker is provided in categories rather than single years. We simulate the single years by just picking a value at random within the time interval, using <code><a href="../reference/num_sim.html">num_sim()</a></code>. We then fill missing data for these variables as follows:</p>
<ul>
<li>For children 8-15 years, we assume that missing values for former smokers’ time since quitting and time spent as a former smoker = 1 year.<br>
</li>
<li>For adults, we fill missing values for former smokers’ time since quitting and time spent as a former smoker with the average value for each age, sex and IMD quintile subgroup.</li>
</ul>
</div>
<div id="smoking-life-histories" class="section level2">
<h2 class="hasAnchor">
<a href="#smoking-life-histories" class="anchor"></a>Smoking life-histories</h2>
<p>The function <code><a href="../reference/smk_life_history.html">smk_life_history()</a></code> cleans the data on the ages when smokers started and stopped being regular cigarette smokers. For each individual smoker, the data recorded in the HSE implies a single age at which a smoker started to smoke and, if they stopped, an age at which they did so. This provides a simplified view of what might be a complicated life history of smoking, e.g. smoking to different frequencies or levels, or starting and stopping multiple times.</p>
<p>Both the start age and stop age will have error in them e.g. due to uncertainty in respondent recall, and, for years 2015+, due to the reporting in categories of time intervals rather than single years, which we then impute introducing random error. Start age is likely to be biased towards earlier ages, because for adult smokers and former smokers with missing values we use the age first tried a cigarette, and for children the reported start age does not necessarily mean the start of regular smoking, it is just the age at which they started to smoke.</p>
<p>We also create a variable for the age at which an individual was censored from our data sample - this is their age at the survey + 1 year.</p>
<p>Any missing data is assigned the average start or stop age for each age, sex and IMD quintile.</p>
</div>
<div id="amount-and-type-of-cigarette-smoked-by-current-smokers" class="section level2">
<h2 class="hasAnchor">
<a href="#amount-and-type-of-cigarette-smoked-by-current-smokers" class="anchor"></a>Amount and type of cigarette smoked by current smokers</h2>
<p>The function <code><a href="../reference/smk_amount.html">smk_amount()</a></code> cleans the data that describe how much, what and to what level of addiction people smoke. The main variable is the average number of cigarettes smoked per day. For adults this is calculated from questions about how many cigarettes are smoked typically on a weekday vs. a weekend. For children, this is based on asking how many cigarettes were smoked in the last week. Missing values are imputed as the average amount smoked for an age, sex and IMD quintile subgroup.</p>
<p>We categorise cigarette preferences based on the answer to ‘what is the main type of cigarette smoked’. In later years of the HSE, new questions are added that ask how many handrolled vs. machine rolled cigarettes are smoked on a weekday vs. a weekend.</p>
<p>We also categorise the amount smoked, and use information on the time from waking until smoking the first cigarette (this latter variable has a high level of missingness). Together these two variables allow calculation of <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3307335/">the heaviness of smoking index</a>.</p>
</div>
</div>
<div id="using-hseclean" class="section level1">
<h1 class="hasAnchor">
<a href="#using-hseclean" class="anchor"></a>Using hseclean</h1>
<div id="load-and-clean-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-and-clean-data" class="anchor"></a>Load and clean data</h2>
<p>The data is stored in <code>X:/ScHARR/PR_Consumption_TA/Data/</code>. The following code will read, clean, filter and combine the data.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># Write a bespoke function that does just the cleaning jobs required.</span>
<span class="no">cleandata</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">data</span>) {
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/clean_age.html">clean_age</a></span>(<span class="no">data</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/clean_demographic.html">clean_demographic</a></span>(<span class="no">data</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/smk_status.html">smk_status</a></span>(<span class="no">data</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/smk_former.html">smk_former</a></span>(<span class="no">data</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/smk_life_history.html">smk_life_history</a></span>(<span class="no">data</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/smk_amount.html">smk_amount</a></span>(<span class="no">data</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/select_data.html">select_data</a></span>(
    <span class="no">data</span>, <span class="kw">ages</span> <span class="kw">=</span> <span class="fl">12</span>:<span class="fl">89</span>, <span class="kw">years</span> <span class="kw">=</span> <span class="fl">2001</span>:<span class="fl">2017</span>,

    <span class="co"># The variables to retain</span>
    <span class="kw">keep_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"wt_int"</span>, <span class="st">"psu"</span>, <span class="st">"cluster"</span>, <span class="st">"year"</span>,
                  <span class="st">"age"</span>, <span class="st">"age_cat"</span>, <span class="st">"censor_age"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>,
                  <span class="st">"cig_smoker_status"</span>, <span class="st">"smk_start_age"</span>, <span class="st">"smk_stop_age"</span>, <span class="st">"years_since_quit"</span>, <span class="st">"giveup_smk"</span>,
                  <span class="st">"cigs_per_day"</span>, <span class="st">"smoker_cat"</span>, <span class="st">"banded_consumption"</span>, <span class="st">"cig_type"</span>, <span class="st">"time_to_first_cig"</span>),

    <span class="co"># The variables that must have complete cases</span>
    <span class="kw">complete_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cig_smoker_status"</span>, <span class="st">"wt_int"</span>, <span class="st">"psu"</span>, <span class="st">"cluster"</span>, <span class="st">"year"</span>, <span class="st">"censor_age"</span>)
  )
<span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">data</span>)
}

<span class="co"># Choose the required years and combine</span>
<span class="no">hse_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/combine_years.html">combine_years</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="fu">cleandata</span>(<span class="fu"><a href="../reference/read_2014.html">read_2014</a></span>()), <span class="fu">cleandata</span>(<span class="fu"><a href="../reference/read_2015.html">read_2015</a></span>()), <span class="fu">cleandata</span>(<span class="fu"><a href="../reference/read_2016.html">read_2016</a></span>())
))

<span class="co"># clean the survey weights</span>
<span class="no">hse_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/clean_surveyweights.html">clean_surveyweights</a></span>(<span class="no">hse_data</span>)

<span class="co"># change some variable names</span>
<span class="fu">setnames</span>(<span class="no">hse_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"smk_start_age"</span>, <span class="st">"cig_smoker_status"</span>, <span class="st">"years_since_quit"</span>),
         <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"start_age"</span>, <span class="st">"smk.state"</span>, <span class="st">"time_since_quit"</span>))</pre></body></html></div>
</div>
<div id="summarise-data" class="section level2">
<h2 class="hasAnchor">
<a href="#summarise-data" class="anchor"></a>Summarise data</h2>
<p>Taking the survey design into account is important when estimating the mean and confidence intervals around summary statistics computed from the data i.e. it is not possible to accurately estimate sampling error without accounting for survey design. The <code>survey</code> R package <span class="citation">(Thomas Lumley <a href="#ref-Rsurvey">2019</a>)</span> has a collection of functions that incorporate survey design into the calculation of summary statistics. The <code>survey</code> package is used by the function <code><a href="../reference/prop_summary.html">prop_summary()</a></code> in <code>hseclean</code> to estimate the uncertainty around proportions calculated from a binary variable - <code><a href="../reference/prop_summary.html">prop_summary()</a></code> was designed to simplify the process of estimating smoking prevalence from the HSE data, stratified by a specified set of variables.</p>
<p>Using <code><a href="../reference/prop_summary.html">prop_summary()</a></code>, calculate the proportion of smokers, stratified by year, sex and quintiles of the Index of Multiple Deprivation.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">prop_smokers</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/prop_summary.html">prop_summary</a></span>(
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">hse_data</span>,
  <span class="kw">var_name</span> <span class="kw">=</span> <span class="st">"smk.state"</span>,
  <span class="kw">levels_1</span> <span class="kw">=</span> <span class="st">"current"</span>,
  <span class="kw">levels_0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"former"</span>, <span class="st">"never"</span>),
  <span class="kw">strat_vars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>)
)</pre></body></html></div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Rsurvey">
<p>Thomas Lumley. 2019. <em>survey: analysis of complex survey samples</em>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d">Duncan Gillespie</a>, Laura Webster, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/angus_c">Colin Angus</a>, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a">Alan Brennan</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
